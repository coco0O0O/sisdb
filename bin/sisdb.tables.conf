
# 配置文件说明：
# 在 sisdb 系统中没有表的概念，取而代之的是字段和字段集
# 字段可以是一个，也可以是多个字段的嵌套和组合，组合后的成为字段集合

# xxx : {
#   format : none,  # 时间的IO格式，默认为空，为一般字段
#     其他可以取的值有 SECOND(4) MSEC(8) INCR(4) DATE(4) NONE(0)
  
#   scale : second,   # 时间的尺度，仅仅当format不为none时生效
#     MSEC ： INCR, MSEC, SECOND, MIN1, MIN5, HOUR, DATE, WEEK, MONTH, YEAR
#     SECOND ： INCR, SECOND, MIN1, MIN5, HOUR, DATE, WEEK, MONTH, YEAR
#     INCR ： INCR
#     DATE ： INCR, DATE, WEEK, MONTH, YEAR
  
#   limit : 1,      # 最大记录数, 默认为1，不控制记录数
#   append-method : ALWAYS,   # 新增记录的判定方法
#     ALWAYS : 不判断直接增加
#     TIMEADD  : 时间尺度增加即增加记录
#     TIMEVOL : 时间尺度和成交量都增加，即增加记录
#   isinit :        # 是否做初始化，主要针对当天实时数据, 会清理掉当前证券当前字段的所有数据
#   publishs: "min,tick,day,min5,mday", # 需要扩散信息到其他的字段集合定义
#   subscribe-method : 方法名
# }

now: {
  scale : SECOND,   
  append-method : "time", 
  limit : 1,      # 单只股票最大记录数
  isinit : 1,     # 是否每天做初始化，主要针对当天实时数据
  publishs: "min,tick,mday,min5,day", # 需要扩散信息到其他的表
  fields: [
  # 字段名| 数据类型| 长度 |
  [time,  second,  4],  # 直接根据format的类型生成time的类型
  [open,   price,  4],
  [high,   price,  4],
  [low,    price,  4],
  [close,  price,  4],
  [vol,   volume,  4],
  [money, volume,  4],
  [askp1,   price, 4],
  [askp2,   price, 4],
  [askp3,   price, 4],
  [askp4,   price, 4],
  [askp5,   price, 4],
  [askv1,   uint, 4],
  [askv2,   uint, 4],
  [askv3,   uint, 4],
  [askv4,   uint, 4],
  [askv5,   uint, 4],
  [bidp1,   price, 4],
  [bidp2,   price, 4],
  [bidp3,   price, 4],
  [bidp4,   price, 4],
  [bidp5,   price, 4],
  [bidv1,   uint, 4],
  [bidv2,   uint, 4],
  [bidv3,   uint, 4],
  [bidv4,   uint, 4],
  [bidv5,   uint, 4]
  ]
}

# 每笔成交的明细表
tick:{
  scale : second, # 按秒增补
  append-method : "time,vol",  # 成交量增长且不为0
  limit : 1200, # 单只股票最大记录数
  isinit : 1,
  fields: [
# 字段名| 数据类型| 长度|
  [time, second,  4],
  [close, price,  4],
  [vol,  volume, 4]
  ]
}

# 分钟线
min:{
  scale : incr,  # 按递增自然数 需要依赖tradetime，避免交易时间外的数据存在
  append-method : "time,vol", 
  limit : 240, # 单只股票最大记录数 0 表示不限制
  isinit : 1,
  fields: [
  # 字段名| 数据类型| 长度|
  [time,  uint,   4],
  [open,  price,  4],
  [high,  price,  4],
  [low,   price,  4],
  [close, price,  4],
  [vol,   volume, 4],
  [money, amount, 4]
  ],
  subscribe-method : {
    # 字段名| 和front比较的方法| 产生新数据的参考字段
    open: [once,close],   # once 仅仅在生成新数据时赋值 其他任何时候不变
    high: [max, close],   # 求最大值，以close为基准 第一个记录直接赋值close
    low:  [min, close]
    # close: [copy,close], # 直接copy的可以不用设置方法
    # vol:   [copy,vol],
    # money: [copy,money]
  }
  # 有这个字段表示当从其他数据publish写入数据时，需要对数组中字段运算
}

#-------------盘后数据------------------
# 日线 其他周月年，和多日K线由此生成，提供数据生产接口
day:{
  scale : date,    # 按天增补
  append-method : "time", 
  fields: [
  # 字段名| 数据类型| 长度|
  [time,  date,   4],
  [open,  price,  4],
  [high,  price,  4],
  [low,   price,  4],
  [close, price,  4],
  [vol,   volume, 4],
  [money, amount, 4]
  ]
}
# 多日线，根据数据多寡可以显示多天的走势图
mday:{
  scale : min1, # 按1分钟增补
  append-method : "time,vol", 
  limit : 1200, # 单只股票最大记录数 约5日数据
  fields: [
  # 字段名| 数据类型| 长度|
  [time,  second, 4],
  [close, price,  4],
  [vol,   volume, 4]
  ],
  subscribe-method : {
    vol:  [incr,vol]
  }
  # 有这个字段表示当从其他数据publish写入数据时，需要对数组中字段运算
}
# 5分钟线，其他分钟线由此生成，提供数据生产接口
min5:{
  scale : min5, # 按5分钟增补
  append-method : "time,vol", 
  limit : 4800, # 单只股票最大记录数
  fields: [
  # 字段名| 数据类型| 长度|
  [time,  second, 4],
  [open,  price,  4],
  [high,  price,  4],
  [low,   price,  4],
  [close, price,  4],
  [vol,   volume, 4],
  [money, amount, 4]
  ],
  subscribe-method : {
    # 字段名| 和front比较的方法| 产生新数据的参考字段
    open: [once,close],
    high: [max,close],
    low:  [min,close],
    # close: [copy,close], # 直接copy的可以不用设置方法
    vol:  [incr,vol],
    money:[incr,money]
  }
  # 有这个字段表示当从其他数据publish写入数据时，需要对数组中字段运算
}

# ------------------------------------------------------------------#
# 这里定义和财务相关的表格，以及其他扩展的数据表
# 此处似乎应该定义一个嵌套的树形表，还没有想好，先按结构化来处理
# 设想中应该也具备时序数据特性，但是字段却是树形结构的，集中的定义一系列字段和字段组合后，其他任何表格都可以直接引用

# 除权表
right:{
  scale : date, # 按天增补
  append-method : "time", 
  fields: [
  # 字段名| 数据类型| 长度|
  [time, date, 4],
  [prc-factor, float, 8, 4], #价格因子 正代表价格跌，负代表价格涨
  [vol-factor, float, 8, 4]  #成交量因子 正代表股份增加， 负代表股数缩减
  ]
}
# 如果前复权，则小于time的价格除以 abs(prc-factor)  正负号表于乘除符号
# 如果后复权，则大于等于time的价格乘以 abs(prc-factor) 

# 基本财务报表
finance:{
  scale : month, # 按月增补
  append-method : "time", 
  fields: [
  # 字段名 | 数据类型| 长度 |
  [time,  date, 4],   #发布日期(年月日)
  # [cycle, uint, 4],   #报表周期(年月)
  [ssrq,  uint, 4],   #上市日期(年月日)
  [zgb,   uint, 4],   #总股本(百股)
  [ltag,  uint, 4],   #流通A股(百股)
  [mgsy,  float, 4, 4],  #每股收益(元)
  [mgjzc, float, 4, 4],  #每股净资产(元) 
  [jzcsyl,float, 4, 2],  #净资产收益率(%) 
  [mggjj, float, 4, 2],  #每股公积金
  [mgwfp, float, 4, 4],  #每股未分配利润
  [mgxj,  float, 4, 4],  #每股现金
  [yysr,  int, 4],    #营业收入(万元)  
  [jlr,   int, 4],    #净利润(万元)
  [tzsy,  int, 4],    #投资收益(万元) 
  [yszk,  int, 4],    #应收账款(万元)  
  [hbzj,  int, 4],    #货币资金(万元)  -- 总现金
  [ldzj,  int, 4],    #流动资金(万元)  -- 总现金
  [sykc,  int, 4]     #剩余库存(万元) 
  ]
}